<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@1,400&display=swap"
rel="stylesheet"
/>
<link rel="icon" href="favicon.png" type="image/png" />
    
<title>A storybook for Eric</title>
<style>
@keyframes float {
  0% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translateY(-100px) scale(1.5);
    opacity: 0;
  }
}

.cover-image {
  width: 60%;
  max-width: 300px;
  height: auto;
  margin: 1.5rem 0;
  object-fit: contain;
  border: none; /* 移除邊框 */
  box-shadow: none; /* 移除陰影 */
}

.cover-author {
  font-size: 1rem;
  color: #888;
  font-style: italic;
}

.vinyl-container {
  margin-top: 2rem;
  width: 120px;
  height: 120px;
  position: relative;
}
#vinyl {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  transition: transform 0.3s ease;
}
.spin {
  animation: spin 3s linear infinite;
}
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

#lyrics {
  font-size: 1.2rem;
  max-width: 90%;
  line-height: 1.8;
  text-align: center;
  transition: opacity 0.5s ease;
}
.english-text {
  font-family: "Cormorant Garamond", serif;
  font-size: 1.2rem;
  font-style: italic;
  color: #777;
  margin-top: 1rem;
}
body {
  margin: 0;
  font-family: "Noto Sans TC", sans-serif;
  background: #fffaf8;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.book {
  position: relative;
  width: 90%;
  max-width: 600px;
  height: 90vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.page {
  flex: 1;
  overflow-y: auto; /* 讓內容可捲動 */
  padding: 2rem;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-size: 1.5rem;
  line-height: 2;
}

.nav {
  position: relative;
  z-index: 2;
  display: flex;
  justify-content: space-between;
  padding: 1rem;
  background: #fffaf8;
}
.page.active {
  display: flex;
}
.nav {
  display: flex;
  justify-content: space-between;
  padding: 1rem;
}
button {
  padding: 0.5rem 1rem;
  background: #ffc0cb;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s;
}
button:hover {
  background: #ffa5b4;
}
.cover-title {
  font-size: 2.5rem;
  color: #ff82a9;
  font-weight: bold;
}

/* 新增：進度 "To Love Page" 按鈕樣式 */
#goToLovePageBtn {
  margin-top: 1rem;
  background: #ff82a9;
  color: white;
  display: none;
}
</style>
</head>
<body>
<audio autoplay loop>
<source src="be-my-ocean.mp3" type="audio/mpeg" />
Your browser does not support the audio element.
</audio>

<div class="book">
<div class="page active">
<div class="cover-title">Serendipity</div>
<img src="star.png" alt="cover image" class="cover-image" />
<div class="cover-author">Story by Jenny / 文・兆珍</div>
</div>

<div class="page">
「我一直以為， 我的世界是由數字組成的。<br />一、二、三……一直到十。<br />一步一步，整齊又有秩序。」
<div class="english-text">
"I always thought my world was made of numbers. One, two, three… all
the way to ten. Step by step, neat and tidy."
</div>
</div>
<div class="page">
「我有我的計劃。<br />每個數字都有位置，<br />每條路都有規則。」
<div class="english-text">
"I had a plan. Every number had a place. Every path had a rule."
</div>
</div>
<div class="page">
「直到……你出現了。」
<div class="english-text">"But then… you came."</div>
</div>
<div class="page">
「你不是我計劃裡的數字。<br />你不照規則走。<br />你……很不一樣。」
<div class="english-text">
"You weren't part of my numbers. You didn't follow the rules. You
were… different."
</div>
</div>
<div class="page">
「一開始，我很困惑。<br />一切……是不是都壞掉了？」
<div class="english-text">
"At first, I was confused. Was everything broken now?"
</div>
</div>
<div class="page">
「但慢慢地，我看見了……<br />不是壞了，<br />而是變成了新的樣子。」
<div class="english-text">
"But slowly, I saw… It wasn't broken. It was becoming something new."
</div>
</div>
<div class="page">
「你沒有破壞規則，<br />而是成為了新的規則。」
<div class="english-text">
"You didn't ruin the rules. You became the new rule. <br />And now my
heart follows only yours."
</div>
</div>
<div class="page">
「你不是例外，<br />你是我唯一的公式，<br />是我的新世界，我的現在<br />和未來。」
<div class="english-text">
"You're not the exception. You are my only rule. My world, <br />my
now and my forever."
</div>
</div>
<div class="page">
<div
style="
  font-size: 1.8rem;
  color: #ff82a9;
  margin-bottom: 1rem;
  font-weight: bold;
"
>
To Eric
</div>
「緣分讓你來到我身邊——<br />
不是偶然，<br />
而是我們靈魂之間安靜又堅定的引力，<br />
讓我們無法分離。」
<div class="english-text">
"Serendipity brought you to me—not by chance, but by the quiet
gravity of our souls <br />refusing to stay apart."
</div>
</div>

<div class="page" id="jukebox-page">
<button id="playSongBtn" style="margin-top: 2rem">
🎵 《Be My Ocean》
</button>
<div class="vinyl-container">
<img id="vinyl" src="vinyl.png" alt="Vinyl Record" />
</div>
<audio id="jukebox-audio" src="be my ocean.m4a"></audio>
<div
id="lyrics"
style="margin-top: 2rem; font-style: italic; color: #666"
>
<!-- 動態歌詞會出現在這裡 -->
</div>
<!-- 新增的按鈕，在音樂結束或遇到問題時顯示 -->
<button id="goToLovePageBtn">繼續我們的故事 💖</button>
</div>

<div class="page" id="love-page" style="position: relative; background-color: #fef9f4; display: flex; justify-content: center; align-items: center;">
  <img
    src="us.png"
    alt="us"
    style="max-width: 100%; max-height: 100%; object-fit: contain; object-position: center;"
  />
</div>

<div class="nav">
<button id="prevBtn">← 上一頁</button>
<button id="nextBtn">下一頁 →</button>
</div>
</div>

<script>
// 全域變數定義
const pages = document.querySelectorAll(".page");
const audio = document.getElementById("jukebox-audio");
const playBtn = document.getElementById("playSongBtn");
const lyricsEl = document.getElementById("lyrics");
const nextBtn = document.getElementById("nextBtn");
const prevBtn = document.getElementById("prevBtn");
const vinyl = document.getElementById("vinyl");
const goToLovePageBtn = document.getElementById("goToLovePageBtn");
let currentPage = 0;
let isPlaying = false;
let songStarted = false;
let audioEndedHandled = false;

// 顯示指定頁面的函數 - 只定義一次
function showPage(index) {
  pages.forEach((p, i) => p.classList.toggle("active", i === index));
  
  // 當到達播放音樂那頁（倒數第二頁）時，隱藏下一頁按鈕
  if (index === pages.length - 2) {
    nextBtn.style.display = "none";
  } else {
    nextBtn.style.display = "inline-block";
  }
  
  // 處理第一頁的上一頁按鈕
  if (index === 0) {
    prevBtn.style.display = "none";
  } else {
    prevBtn.style.display = "inline-block";
  }

  // 重置音樂頁面狀態
  if (index === pages.length - 2) {
    goToLovePageBtn.style.display = "none";
    // 避免重複添加計時器
    setupSongEndFallback();
  }
}

// 翻頁函數
function nextPage() {
  if (currentPage < pages.length - 1) {
    currentPage++;
    showPage(currentPage);
  }
}

function prevPage() {
  if (currentPage > 0) {
    currentPage--;
    showPage(currentPage);
  }
}

// 進入最後愛心頁面
function goToLovePage() {
  currentPage = pages.length - 1;
  showPage(currentPage);
  
  // 顯示表達愛意的按鈕
  nextBtn.textContent = "I love you ❤️";
  nextBtn.removeEventListener("click", nextPage);
  nextBtn.addEventListener("click", createHeart);
}

// 愛心動畫函數
function createHeart() {
  const heart = document.createElement("div");
  heart.textContent = "💖";
  heart.style.position = "absolute";
  heart.style.left = Math.random() * 90 + "%";
  heart.style.top = Math.random() * 90 + "%";
  heart.style.fontSize = "2rem";
  heart.style.animation = "float 2s ease-out forwards";
  document.querySelector(".book").appendChild(heart);

  setTimeout(() => heart.remove(), 2000);
}

// 歌詞數據
const lyricsData = [
  { time: 0, text: "" },
  { time: 6, text: "I'm in love with you, yes <br />I feel it" },
  { time: 10, text: "Will you be the one to catch these feelings" },
  { time: 16, text: "With you on this bed the air is something" },
  { time: 20, text: "It took my breath away" },
  { time: 26, text: "You're my hopeless devotion" },
  { time: 29, text: "Dealing oh with you, I do with caution" },
  { time: 34, text: "Because I don't want the two of us to be broken" },
  { time: 39, text: "So just take me" },
  { time: 42, text: "Be my ocean <br />What is the commotion?" },
  { time: 46, text: "I just wanna dive in the river" },
  { time: 49, text: "To be with the one I love" },
  { time: 52, text: "And if I tried to hurt you" },
  { time: 55, text: "Still I'd belong to you" },
  { time: 58, text: "Dive in the river" },
  { time: 60, text: "To be with <br />To be with the" },
  { time: 63, text: "Be with the one I love" },
  { time: 69, text: "Am I dead already?" },
  { time: 73, text: "Abandon ship, these waves they tip me over" },
  { time: 78, text: "And I'm just about to sink" },
  { time: 80, text: "But if you're ever down and out" },
  { time: 83, text: "And if there ever is a doubt" },
  { time: 86, text: "Then you call me" },
  { time: 91, text: "Be my ocean <br />What is the commotion?" },
  { time: 95, text: "I just wanna dive in the river" },
  { time: 98, text: "To be with the one I love" },
  { time: 101,text: "And if I tried to hurt you" },
  { time: 105, text: "Still I'd belong to you" },
  { time: 107, text: "Dive in the river" },
  { time: 109, text: "To be with the one I love" },
  { time: 112, text: "Let it be <br />Just you and me" },
  { time: 114, text: "Now if I could drown in you" },
  { time: 117, text: "Baby please <br />I need your release" },
  { time: 119, text: "Now if I could drown in you" },
  { time: 123, text: "" },
  { time: 126, text: "Now if I could drown in you" },
  { time: 128, text: "" },
{ time: 130, text: "寶寶" },
    { time: 132, text: "你的出現是流星 闖進了我的生活" },
    { time: 134, text: "我想" },
    { time: 136, text: "一定是我曾經許下的心願 變成你" },
    { time: 138, text: "來到我身邊了!" },
    { time: 140, text: "謝謝你來了" },
     { time: 142, text: "還請你繼續留在我身邊歐! ❤" },
  { time: 145, text: "And if I could" },
  { time: 146, text: "And if I could drown in you" },
  { time: 150, text: "❤" },

];

// 歌曲播放完畢檢查的備用方案
function setupSongEndFallback() {
  // 保存開始播放時間，用來計算預期結束時間
  let songEndCheckerTimer;
  
  // 清除可能已存在的計時器
  if (songEndCheckerTimer) {
    clearInterval(songEndCheckerTimer);
  }
  
  // 設置一個檢查器，在播放中顯示「繼續」按鈕
  songEndCheckerTimer = setInterval(() => {
    // 如果歌曲已經開始播放
    if (isPlaying) {
      // 檢查是否接近歌曲結束（根據最後一條歌詞時間估算）
      const currentTime = audio.currentTime;
      
      // 當歌曲播放到接近尾聲（最後一條歌詞後5秒）時
      if (currentTime >= 150 && !audioEndedHandled) {
        // 已經接近結束，顯示繼續按鈕
        goToLovePageBtn.style.display = "inline-block";
      }
      
      // 如果音樂已經結束但沒有正確觸發ended事件
      if (audio.ended && !audioEndedHandled) {
        handleAudioEnded();
      }
    }
  }, 1000);
}

// 處理音頻結束的函數
function handleAudioEnded() {
  // 標記已處理，避免重複觸發
  audioEndedHandled = true;
  
  // 顯示繼續按鈕
  goToLovePageBtn.style.display = "inline-block";
  
  // 停止旋轉唱片
  vinyl.classList.remove("spin");
  
  // 更新播放按鈕文字
  playBtn.textContent = "🎵 《Be My Ocean》";
  isPlaying = false;
}

// 事件監聽器設置
// 正確設置按鈕的點擊事件
nextBtn.addEventListener("click", nextPage);
prevBtn.addEventListener("click", prevPage);
goToLovePageBtn.addEventListener("click", goToLovePage);

// 音樂播放按鈕事件
playBtn.addEventListener("click", () => {
  if (isPlaying) {
    audio.pause();
    vinyl.classList.remove("spin");
    playBtn.textContent = "🎵 《Be My Ocean》";
  } else {
    audio.play().catch(err => {
      // 處理播放失敗的情況（特別是在移動設備上）
      console.error("播放失敗:", err);
      // 顯示繼續按鈕，讓用戶可以手動進入下一頁
      goToLovePageBtn.style.display = "inline-block";
    });
    vinyl.classList.add("spin");
    playBtn.textContent = "⏸️ 我愛你寶寶 ❤️ ";
    songStarted = true;
    audioEndedHandled = false; // 重置結束標記
  }
  isPlaying = !isPlaying;
});

// 歌詞更新事件
audio.addEventListener("timeupdate", () => {
  const currentTime = audio.currentTime;
  const currentLyric = lyricsData
    .slice()
    .reverse()
    .find((line) => currentTime >= line.time);
  if (currentLyric) {
    lyricsEl.innerHTML = currentLyric.text;
  }
});

// 音樂結束事件
audio.addEventListener("ended", handleAudioEnded);

// 音頻錯誤處理
audio.addEventListener("error", () => {
  console.error("音頻加載錯誤");
  // 顯示繼續按鈕，讓用戶可以手動進入下一頁
  goToLovePageBtn.style.display = "inline-block";
});

// 初始化頁面設置
showPage(currentPage);
// 初始狀態下隱藏上一頁按鈕
if (currentPage === 0) {
  prevBtn.style.display = "none";
}
</script>
</body>
</html>
